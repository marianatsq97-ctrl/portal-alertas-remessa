<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal de Alertas - Remessas</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="container">
      <header class="topbar">
        <div>
          <h1>Portal de Alertas - Remessas</h1>
          <p>Acompanhamento de contratos, consumo TopCon e alertas automáticos (&gt; 7 dias).</p>
        </div>
        <button class="btn btn-outline" type="button">Sair</button>
      </header>

      <section class="panel controls-panel">
        <div class="controls-row">
          <input type="file" id="fileInput" accept=".csv,.csc,.xls,.xlsx,.json" />
          <button id="uploadBtn" class="btn btn-primary" type="button">Carregar arquivo</button>
          <button id="demoBtn" class="btn btn-secondary" type="button">Carregar demo</button>
          <button id="clearBtn" class="btn btn-danger" type="button">Excluir dados</button>
        </div>
        <p id="statusText">Nenhum arquivo selecionado</p>

        <div class="filters">
          <label>
            <span class="sr-only">Filtrar por ano</span>
            <select id="yearFilter"></select>
          </label>
          <label>
            <span class="sr-only">Filtrar por mês</span>
            <select id="monthFilter"></select>
          </label>
          <label>
            <span class="sr-only">Data inicial</span>
            <input type="date" id="startDate" />
          </label>
          <label>
            <span class="sr-only">Data final</span>
            <input type="date" id="endDate" />
          </label>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Painel ADM (importação)</h2>
          <small id="adminLastImport">Sem importação recente</small>
        </div>
        <p id="adminInfo">Envie o arquivo no painel ADM para atualizar os dados que os usuários visualizam.</p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Arquivo</th>
                <th>Formato</th>
                <th>Data/Hora</th>
                <th>Registros</th>
              </tr>
            </thead>
            <tbody id="importHistoryBody">
              <tr><td colspan="4">Nenhuma importação registrada.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Alertas automáticos (SQL42 / TopCon)</h2>
          <small id="alertsGeneratedAt">Aguardando processamento...</small>
        </div>
        <p id="alertsMeta">Regra: se <strong>data de hoje - data da última remessa &gt; 7</strong>, status = <strong>PLANO DE AÇÃO</strong>.</p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Última remessa</th>
                <th>Dias sem remessa</th>
                <th>Status</th>
                <th>Ação</th>
              </tr>
            </thead>
            <tbody id="alertsTableBody">
              <tr><td colspan="5">Sem alertas processados.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="panel">
        <h2>Resumo</h2>
        <div class="summary-grid top">
          <article class="card">
            <strong id="contractsCount">0</strong>
            <span>Contratos exibidos</span>
          </article>
          <article class="card">
            <strong id="clientsCount">0</strong>
            <span>Clientes únicos (CNPJ)</span>
          </article>
          <article class="card">
            <strong id="volumeCount">0</strong>
            <span>Volume total da obra</span>
          </article>
        </div>
        <div class="summary-grid bottom">
          <article class="card status ok">
            <h3>OK</h3>
            <strong id="okCount">0</strong>
            <span>0 a 7 dias sem remessa</span>
          </article>
          <article class="card status warn">
            <h3>Atenção</h3>
            <strong id="warnCount">0</strong>
            <span>8 a 14 dias sem remessa</span>
          </article>
          <article class="card status alert">
            <h3>Atenção grave</h3>
            <strong id="alertCount">0</strong>
            <span>15 a 21 dias sem remessa</span>
          </article>
          <article class="card status critical">
            <h3>Plano de ação</h3>
            <strong id="criticalCount">0</strong>
            <span>&gt; 21 dias sem remessa</span>
          </article>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Evolução de remessas</h2>
          <button id="refreshChart" class="btn btn-outline" type="button">Atualizar gráfico</button>
        </div>
        <div id="chart" class="chart"></div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Detalhamento</h2>
          <div class="pager">
            <button id="prevPage" class="btn btn-outline" type="button">Anterior</button>
            <button id="nextPage" class="btn btn-outline" type="button">Próxima</button>
          </div>
        </div>
        <p id="tableMeta">Ordenado da maior para a menor urgência (dias sem remessa).</p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>CNPJ / Cliente</th>
                <th>Contrato</th>
                <th>Nome da obra</th>
                <th>Volume da obra</th>
                <th>Última remessa</th>
                <th>Dias sem remessa</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </section>

      <footer class="footer">Build 2026-02-22h</footer>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
